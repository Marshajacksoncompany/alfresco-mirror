<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd">
      
    <!-- Object factories -->

    <bean id="sectionFactory" class="org.alfresco.wcm.client.impl.SectionFactoryCmisImpl">
       <property name="sectionsRefreshAfter" value="60"/>
       <property name="assetFactory" ref="assetFactory"/>
	   <property name="dictionaryService" ref="dictionaryService"/>       
    </bean>

    <bean id="collectionFactory" class="org.alfresco.wcm.client.impl.CollectionFactoryWebserviceImpl">
        <property name="assetFactory" ref="assetFactory" />
        <property name="sectionFactory" ref="sectionFactory" />
        <property name="webscriptCaller" ref="webscriptCaller" />
    </bean>


    <bean id="assetFactory" class="org.alfresco.wcm.client.impl.CachingAssetFactoryImpl">
        <property name="delegate">
            <bean class="org.alfresco.wcm.client.impl.AssetFactoryCmisImpl">
                <property name="collectionFactory" ref="collectionFactory" />
                <property name="sectionFactory" ref="sectionFactory" />
            </bean>
        </property>
        <property name="cache">
            <bean class="org.alfresco.wcm.client.impl.cache.EhCacheAdapter">
                <property name="cache">
                    <bean class="org.springframework.cache.ehcache.EhCacheFactoryBean">
                        <property name="cacheManager">
                            <ref bean="ehCacheManager" />
                        </property>
                        <property name="cacheName">
                            <value>assetCache</value>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>

    <!-- Service for fetching site data. Implements a cache. -->    
    <bean id="webSiteService" class="org.alfresco.wcm.client.impl.WebSiteServiceImpl">
        <property name="webSiteCacheRefreshAfter" value="300" />
        <property name="urlUtils" ref="urlUtils" />
        <property name="sectionFactory" ref="sectionFactory" />
        <property name="assetFactory" ref="assetFactory" />
        <property name="webscriptCaller" ref="webscriptCaller" />
        <property name="logoFilename" value="logo.%" />
        <property name="formIdCache">
            <bean class="org.alfresco.wcm.client.impl.cache.EhCacheAdapter">
                <property name="cache">
                    <bean class="org.springframework.cache.ehcache.EhCacheFactoryBean">
                        <property name="cacheManager">
                            <ref bean="ehCacheManager" />
                        </property>
                        <property name="cacheName">
                            <value>formIdCache</value>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>
    
    <!--  Dictionary service -->
    <bean id="dictionaryService" class="org.alfresco.wcm.client.impl.DictionaryServiceImpl"/>
    
	<bean id="webscriptCaller" class="org.alfresco.wcm.client.impl.WebScriptCallerImpl" init-method="init">
		<property name="baseUrl" value="%{quickstart.repo.baseWebscriptUrl}" />
		<property name="credentials">
			<bean class="org.apache.commons.httpclient.UsernamePasswordCredentials">
				<constructor-arg value="%{quickstart.repo.user}"/>
				<constructor-arg value="%{quickstart.repo.password}"/>
			</bean>
		</property>
	</bean>
    
    <!-- Services which make the factories available to webscripts -->
        
    <bean id="collectionService" parent="baseScriptExtension" class="org.alfresco.wcm.client.service.CollectionService">
       <property name="extensionName" value="collectionService"/>    
       <property name="collectionFactory" ref="collectionFactory"/>
    </bean>  
       
   <bean name="ehCacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" />
   
</beans>
