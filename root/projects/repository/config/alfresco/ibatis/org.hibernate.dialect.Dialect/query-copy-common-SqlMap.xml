<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="alfresco.query.copy">

    <!--                -->
    <!-- Result Maps    -->
    <!--                -->
    
    <resultMap id="result_Copy" type="Node">
        <result property="id" column="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <result property="store.protocol" column="protocol" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="store.identifier" column="identifier" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="uuid" column="uuid" jdbcType="VARCHAR" javaType="java.lang.String"/>
    </resultMap>
    
    <!--                -->
    <!-- SQL Selects    -->
    <!--                -->
    
    <!-- Query to get copies of a node -->
    <select id="select_GetCopies" parameterType="CopyParameters" resultMap="result_Copy">
        select
            copiedNode.id            as id,
            copiedStore.protocol     as protocol,
            copiedtore.identifier    as identifier,
            copiedNode.uuid          as uuid,
        from
            alf_node_assoc assoc
            join alf_node copiedNode on (copiedNode.id = assoc.targetNodeId)
            join alf_store copiedStore on (copiedStore.id = copiedNode.store_id)
        where
            assoc.target_node_id = #{originalNodeId} and
            assoc.type_qname_id = #{copiedFromAssocTypeId}  
    </select>
    
</mapper>