<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

   <!-- Replication Service -->

   <bean id="ReplicationService" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="proxyInterfaces">
         <value>org.alfresco.service.cmr.replication.ReplicationService</value>
      </property>
      <property name="target">
         <ref bean="replicationService" />
      </property>
      <property name="interceptorNames">
         <list>
            <idref local="ReplicationService_transaction" />
            <idref bean="AuditMethodInterceptor" />
            <idref bean="exceptionTranslator" />
            <idref local="ReplicationService_security" />
         </list>
      </property>
   </bean>

   <!-- Replication service transaction bean -->
   <bean id="ReplicationService_transaction"
      class="org.springframework.transaction.interceptor.TransactionInterceptor">
      <property name="transactionManager">
         <ref bean="transactionManager" />
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">${server.transaction.mode.default}</prop>
         </props>
      </property>
   </bean>

   <!-- Replication service security bean -->
   <bean id="ReplicationService_security"
      class="org.alfresco.repo.security.permissions.impl.AlwaysProceedMethodInterceptor" />

   <!-- Replication Service base bean -->
	<bean id="replicationService" class="org.alfresco.repo.replication.ReplicationServiceImpl" >
      <property name="nodeService" ref="NodeService" />
      <property name="actionService" ref="ActionService"/>
      <property name="dictionaryService" ref="dictionaryService" />
      <property name="transferService" ref="TransferService" />
      <property name="scheduledPersistedActionService" ref="scheduledPersistedActionService" />
      <property name="replicationDefinitionPersister" ref="replicationDefinitionPersister" />
	</bean>

    <bean id="replicationDefinitionPersister" class="org.alfresco.repo.replication.ReplicationDefinitionPersisterImpl" >
        <property name="runtimeActionService" ref="actionService" />
        <property name="nodeService" ref="NodeService" />
    </bean>


   <!-- Replication Action executor -->

   <bean id="replicationActionExecutor" parent="action-executer"
      class="org.alfresco.repo.replication.ReplicationActionExecutor">
      <property name="publicAction">
         <value>false</value>
      </property>
      <property name="applicableTypes">
         <list>
            <value>{http://www.alfresco.org/model/content/1.0}content</value>
            <value>{http://www.alfresco.org/model/content/1.0}folder</value>
         </list>
      </property>
       <property name="jobLockService" ref="JobLockService" />
       <property name="transferService" ref="TransferService" />
       <property name="replicationService" ref="ReplicationService" />
       <property name="nodeCrawlerFactory" ref="NodeCrawlerFactory" />
       <property name="actionTrackingService" ref="actionTrackingService" />
   </bean>


   <!-- JavaScript API support -->
   <bean id="replicationServiceScript" parent="baseJavaScriptExtension"
         class="org.alfresco.repo.replication.script.ScriptReplicationService">
        <property name="extensionName">
            <value>replicationService</value>
        </property>
        <property name="serviceRegistry" ref="ServiceRegistry"/>
        <property name="replicationService" ref="ReplicationService"/>
    </bean>
   
</beans>
